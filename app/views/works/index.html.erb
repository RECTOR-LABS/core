<% content_for :title, "Work" %>

<div class="container-work">
  <div class="mb-6 sm:mb-8">
    <%= link_to "‚Üê Home", root_path, class: "back-link" %>
  </div>

  <!-- Header -->
  <div class="work-header">
    <h1>Work</h1>
    <p class="work-tagline">
      Projects I've built, problems I've solved, and stories worth telling.
    </p>
  </div>

  <!-- Stats Banner -->
  <div class="work-stats-banner">
    <div class="work-stat">
      <span class="work-stat-value">4</span>
      <span class="work-stat-label">wins</span>
    </div>
    <span class="work-stat-divider">‚Ä¢</span>
    <div class="work-stat">
      <span class="work-stat-value">~$10,800</span>
      <span class="work-stat-label">earned</span>
    </div>
    <span class="work-stat-divider">‚Ä¢</span>
    <div class="work-stat">
      <span class="work-stat-value"><%= @works.count %></span>
      <span class="work-stat-label">projects</span>
    </div>
  </div>

  <% winners = @works.where(status: "Winner").order(launched_at: :desc) %>
  <% active = @works.where.not(status: "Winner").order(launched_at: :desc) %>

  <!-- Hackathon Wins Section -->
  <% if winners.any? %>
    <section class="work-section">
      <h2 class="work-section-title">
        <span class="work-section-icon">üèÜ</span>
        Hackathon & Bounty Wins
      </h2>

      <div class="work-grid">
        <% winners.each do |work| %>
          <%= link_to work_path(work), class: "work-card work-card-winner" do %>
            <div class="work-card-header">
              <% badge = case work.title
                when "Web3 Deal Discovery" then { icon: "ü•á", text: "1st Place", prize: "$5,000 + NFT", event: "MonkeDAO Cypherpunk" }
                when "SIP Protocol" then { icon: "üèÜ", text: "Winner", prize: "$6,500", event: "Zypherpunk ‚Ä¢ 3 Tracks" }
                when "OpenBudget.ID" then { icon: "ü•à", text: "2nd Place", prize: "$1,500", event: "Garuda Spark" }
                when "Saros SDK Docs" then { icon: "ü•á", text: "1st Place", prize: "$300", event: "Saros SDK Challenge" }
                else { icon: "üèÜ", text: "Winner", prize: "", event: "" }
              end %>

              <div class="work-card-badge badge-winner">
                <%= badge[:icon] %> <%= badge[:text] %>
              </div>
              <span class="work-card-prize"><%= badge[:prize] %></span>
            </div>

            <h3 class="work-card-title"><%= work.title %></h3>
            <p class="work-card-event"><%= badge[:event] %></p>
            <p class="work-card-summary"><%= work.summary %></p>

            <% repo = GithubRepo.find_by(full_name: work.repo_name) %>
            <div class="work-card-meta">
              <% if work.technologies.present? %>
                <span class="work-card-tech"><%= work.technologies.first(3).join(" ‚Ä¢ ") %></span>
              <% end %>
              <% stars = repo&.stargazers_count || work.github_stars %>
              <% if stars.to_i > 0 %>
                <span class="work-card-stars">‚≠ê <%= stars %></span>
              <% end %>
              <% if repo&.commit_count.to_i > 0 %>
                <span class="work-card-commits">‚äô <%= repo.commit_count %></span>
              <% end %>
              <% if repo&.latest_commit_sha.present? %>
                <span class="work-card-sha font-mono text-[10px] text-brown/40"><%= repo.latest_commit_sha %></span>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>
    </section>
  <% end %>

  <!-- Active Projects Section -->
  <% if active.any? %>
    <section class="work-section"
             data-controller="filter-sort show-more"
             data-filter-sort-sort-by-value="date"
             data-show-more-limit-value="12"
             data-action="filter-sort:filtered->show-more#handleFilter">
      <div class="work-section-header">
        <h2 class="work-section-title">
          <span class="work-section-icon">üî®</span>
          Active Projects
          <span class="work-counter" data-filter-sort-target="counter"><%= active.count %> projects</span>
        </h2>
      </div>

      <!-- Filter Chips -->
      <div class="filter-bar">
        <div class="filter-chips">
          <button class="filter-chip active" data-filter-sort-target="filterChip" data-tech="all" data-action="click->filter-sort#toggleFilter">
            All
          </button>
          <% %w[TypeScript Solana Rust Next.js Anchor Python AI Shell].each do |tech| %>
            <button class="filter-chip" data-filter-sort-target="filterChip" data-tech="<%= tech.downcase %>" data-action="click->filter-sort#toggleFilter">
              <%= tech %>
            </button>
          <% end %>
        </div>

        <!-- Sort Buttons -->
        <div class="sort-buttons">
          <span class="sort-label">Sort:</span>
          <button class="sort-btn active" data-filter-sort-target="sortButton" data-sort="date" data-action="click->filter-sort#setSort">
            Latest
          </button>
          <button class="sort-btn" data-filter-sort-target="sortButton" data-sort="stars" data-action="click->filter-sort#setSort">
            Stars
          </button>
          <button class="sort-btn" data-filter-sort-target="sortButton" data-sort="commits" data-action="click->filter-sort#setSort">
            Commits
          </button>
          <button class="sort-btn" data-filter-sort-target="sortButton" data-sort="alpha" data-action="click->filter-sort#setSort">
            A-Z
          </button>
        </div>
      </div>

      <div class="work-grid">
        <% active.each do |work| %>
          <% repo = GithubRepo.find_by(full_name: work.repo_name) %>
          <% stars = repo&.stargazers_count || work.github_stars || 0 %>
          <% commits = repo&.commit_count || 0 %>
          <%= link_to work_path(work),
              class: "work-card work-card-active",
              data: {
                filter_sort_target: "card",
                show_more_target: "item",
                technologies: (work.technologies || []).to_json,
                stars: stars,
                commits: commits,
                date: work.launched_at&.iso8601,
                title: work.title
              } do %>
            <div class="work-card-header">
              <% if work.status == "Live" %>
                <div class="work-card-badge badge-live">
                  <span class="live-pulse"></span> Live
                </div>
              <% elsif work.status.present? %>
                <div class="work-card-badge badge-status"><%= work.status %></div>
              <% end %>
            </div>

            <h3 class="work-card-title"><%= work.title %></h3>
            <p class="work-card-summary"><%= work.summary %></p>

            <div class="work-card-meta">
              <% if work.technologies.present? %>
                <span class="work-card-tech"><%= work.technologies.first(3).join(" ‚Ä¢ ") %></span>
              <% end %>
              <% if stars.to_i > 0 %>
                <span class="work-card-stars"><%= stars %></span>
              <% end %>
              <% if commits.to_i > 0 %>
                <span class="work-card-commits"><%= commits %></span>
              <% end %>
              <% if repo&.latest_commit_sha.present? %>
                <span class="work-card-sha font-mono text-[10px] text-brown/40"><%= repo.latest_commit_sha %></span>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>

      <!-- Show More Button -->
      <% if active.count > 12 %>
        <div class="work-show-more">
          <button data-show-more-target="button" data-action="click->show-more#toggle" class="show-more-btn">
            Show <%= active.count - 12 %> more
          </button>
        </div>
      <% end %>

      <!-- No Results Message -->
      <div class="no-results hidden" data-filter-sort-target="noResults">
        <p>No projects match your filters. Try adjusting your selection.</p>
      </div>
    </section>
  <% end %>

  <% if @works.empty? %>
    <div class="text-center py-12">
      <p class="text-[#3B2C22]/50">No work published yet. Check back soon!</p>
    </div>
  <% end %>
</div>
